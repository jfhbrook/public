SPEC := "yq.spec"

lint:
  shellcheck ./scripts/*.sh

# Build the source rpm
srpm:
  spec="$(pwd)/{{SPEC}}" outdir="$(pwd)" make -f ../../.copr/Makefile

# Verify the source rpm
verify:
  rpmbuild --rebuild "$(echo '{{SPEC}}' | sed 's/\.spec//')-"*.src.rpm

# Build and verify
test: srpm verify

# Clean files created from building and verifying
clean:
  rm -rf ./src
  rm -rf ./builddir
  rm -f "$(ls *.spec | sed 's/\.spec//')-"*.src.rpm

# Apply copr configuration
apply:
  coprctl apply -f ./copr.yml

publish:
  git push origin
  copr build-package jfhbrook/joshiverse --name "$(ls *.spec | sed 's/\.spec//')"
